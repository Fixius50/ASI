<!DOCTYPE html>
<html lang="es" class="dark">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Model Benchmark Dashboard</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Google Fonts: Inter (UI) & JetBrains Mono (Data) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap"
    rel="stylesheet">

  <!-- Tailwind Config -->
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            tech: {
              primary: '#3b82f6',   // Blue 500
              accent: '#06b6d4',    // Cyan 500
              dark: '#0f172a',      // Slate 900
              surface: '#1e293b',   // Slate 800
              light: '#f8fafc',     // Slate 50
              text: '#334155',      // Slate 700
            }
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
            mono: ['"JetBrains Mono"', 'monospace'],
          }
        }
      }
    }
  </script>

  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    /* Smooth transitions for theme switching */
    body,
    div,
    nav,
    button,
    span,
    h1,
    h2,
    h3,
    p {
      transition-property: background-color, border-color, color, fill, stroke;
      transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
      transition-duration: 300ms;
    }

    /* Modal Animation */
    @keyframes slideUp {
      from {
        transform: translateY(20px);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .modal-animate {
      animation: slideUp 0.3s ease-out forwards;
    }

    /* Chart Container Fix */
    .chart-container {
      position: relative;
      height: 400px;
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }
  </style>
</head>

<body
  class="bg-tech-light text-tech-text dark:bg-tech-dark dark:text-gray-200 font-sans min-h-screen flex flex-col antialiased">

  <!-- HEADER / NAVBAR -->
  <nav
    class="sticky top-0 z-40 w-full bg-white/80 dark:bg-tech-dark/90 backdrop-blur-md border-b border-gray-200 dark:border-gray-800">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16 items-center">
        <!-- Logo -->
        <div class="flex items-center gap-3">
          <div
            class="w-8 h-8 rounded bg-gradient-to-tr from-blue-600 to-cyan-500 flex items-center justify-center text-white shadow-lg shadow-blue-500/30">
            <i class="fa-solid fa-layer-group text-sm"></i>
          </div>
          <span class="text-lg font-bold tracking-tight text-gray-900 dark:text-white">AI Benchmarks</span>
        </div>

        <!-- Theme Toggle -->
        <button onclick="toggleTheme()"
          class="w-10 h-10 rounded-full flex items-center justify-center bg-gray-100 hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500">
          <i class="fa-solid fa-sun text-yellow-500 text-lg hidden dark:block"></i>
          <i class="fa-solid fa-moon text-gray-600 text-lg dark:hidden"></i>
        </button>
      </div>
    </div>
  </nav>

  <!-- MAIN CONTENT -->
  <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 w-full">

    <header class="mb-10 flex flex-col sm:flex-row sm:items-end justify-between gap-4">
      <div>
        <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">
          Análisis de Modelos
        </h1>
        <p class="text-gray-500 dark:text-gray-400 max-w-2xl">
          Comparativa técnica basada en velocidad (tk/s), razonamiento lógico, costes y manejo de contexto extenso.
        </p>
      </div>
      <!-- Status Indicator -->
      <div
        class="flex items-center gap-2 px-3 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded-full text-xs font-semibold">
        <span class="relative flex h-2 w-2">
          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
          <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
        </span>
        Data Live
      </div>
    </header>

    <!-- GRID SYSTEM -->
    <div class="grid grid-cols-1 gap-6">

      <!-- CARD 1: COMPARATIVA GENERAL (Full Width ahora) -->
      <article
        class="bg-white dark:bg-tech-surface rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-md transition-shadow">
        <div class="p-6">
          <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4">
            <div>
              <h2 class="text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2">
                <i class="fa-solid fa-trophy text-yellow-500"></i> Ranking Global
              </h2>
              <p class="text-sm text-gray-500 font-mono mt-1">Puntuación agregada (0-100)</p>
            </div>
            <button onclick="openModal()"
              class="w-full sm:w-auto py-2.5 px-5 bg-tech-primary hover:bg-blue-600 text-white text-sm font-semibold rounded-lg shadow-lg shadow-blue-500/30 transition-all transform hover:-translate-y-0.5 flex justify-center items-center gap-2">
              <i class="fa-solid fa-chart-radar"></i> Abrir Análisis Interactivo
            </button>
          </div>

          <!-- Comparison List (Horizontal on large screens) -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-4">
            <!-- Model 1 -->
            <div class="bg-gray-50 dark:bg-gray-800/50 p-4 rounded-lg border border-gray-100 dark:border-gray-700">
              <div class="flex justify-between items-center mb-3">
                <div class="flex items-center gap-2">
                  <span class="w-3 h-3 rounded-full bg-blue-500"></span>
                  <span class="font-bold text-gray-900 dark:text-white">Gemini 1.5 Pro</span>
                </div>
                <span class="font-mono text-xl font-bold text-blue-600 dark:text-blue-400">92.4</span>
              </div>
              <div class="space-y-2">
                <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400">
                  <span>Velocidad</span>
                  <span class="font-medium">Alta</span>
                </div>
                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5">
                  <div class="bg-blue-500 h-1.5 rounded-full" style="width: 85%"></div>
                </div>
              </div>
            </div>

            <!-- Model 2 -->
            <div class="bg-gray-50 dark:bg-gray-800/50 p-4 rounded-lg border border-gray-100 dark:border-gray-700">
              <div class="flex justify-between items-center mb-3">
                <div class="flex items-center gap-2">
                  <span class="w-3 h-3 rounded-full bg-cyan-500"></span>
                  <span class="font-bold text-gray-900 dark:text-white">GPT-4o</span>
                </div>
                <span class="font-mono text-xl font-bold text-cyan-600 dark:text-cyan-400">90.8</span>
              </div>
              <div class="space-y-2">
                <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400">
                  <span>Velocidad</span>
                  <span class="font-medium">Muy Alta</span>
                </div>
                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5">
                  <div class="bg-cyan-500 h-1.5 rounded-full" style="width: 95%"></div>
                </div>
              </div>
            </div>

            <!-- Model 3 -->
            <div class="bg-gray-50 dark:bg-gray-800/50 p-4 rounded-lg border border-gray-100 dark:border-gray-700">
              <div class="flex justify-between items-center mb-3">
                <div class="flex items-center gap-2">
                  <span class="w-3 h-3 rounded-full bg-violet-500"></span>
                  <span class="font-bold text-gray-900 dark:text-white">Claude 3.5 Sonnet</span>
                </div>
                <span class="font-mono text-xl font-bold text-violet-600 dark:text-violet-400">94.1</span>
              </div>
              <div class="space-y-2">
                <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400">
                  <span>Velocidad</span>
                  <span class="font-medium">Media</span>
                </div>
                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5">
                  <div class="bg-violet-500 h-1.5 rounded-full" style="width: 80%"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </article>

    </div>

    <!-- SECTION: METHODOLOGY / PROMPTS -->
    <section class="mt-10">
      <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3">
        <i class="fa-solid fa-flask text-tech-primary"></i> Banco de Pruebas
        <span
          class="text-sm font-normal text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 px-3 py-1 rounded-full">Metodología
          de Evaluación</span>
      </h2>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

        <!-- Card: Acertijos de Lógica -->
        <article
          class="bg-white dark:bg-tech-surface rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 flex flex-col h-full">
          <div class="flex items-center gap-3 mb-5 border-b border-gray-100 dark:border-gray-700 pb-4">
            <div
              class="w-10 h-10 rounded-lg bg-yellow-100 dark:bg-yellow-900/20 text-yellow-600 dark:text-yellow-400 flex items-center justify-center text-lg shadow-sm">
              <i class="fa-solid fa-lightbulb"></i>
            </div>
            <div>
              <h3 class="text-lg font-bold text-gray-900 dark:text-white">Acertijos de Lógica (Reasoning)</h3>
              <p class="text-xs text-gray-500">Evalúa capacidad de deducción y "Chain-of-Thought".</p>
            </div>
          </div>

          <div id="riddles-container" class="space-y-4 flex-grow">
            <!-- Content will be injected by JS -->
            <div class="animate-pulse flex space-x-4 p-4">
              <div class="flex-1 space-y-4 py-1">
                <div class="h-2 bg-gray-200 dark:bg-gray-700 rounded"></div>
                <div class="space-y-3">
                  <div class="grid grid-cols-3 gap-4">
                    <div class="h-2 bg-gray-200 dark:bg-gray-700 rounded col-span-2"></div>
                    <div class="h-2 bg-gray-200 dark:bg-gray-700 rounded col-span-1"></div>
                  </div>
                  <div class="h-2 bg-gray-200 dark:bg-gray-700 rounded"></div>
                </div>
              </div>
            </div>
          </div>
        </article>

        <!-- Card: Prompts de Contexto -->
        <article
          class="bg-white dark:bg-tech-surface rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 flex flex-col h-full">
          <div class="flex items-center gap-3 mb-5 border-b border-gray-100 dark:border-gray-700 pb-4">
            <div
              class="w-10 h-10 rounded-lg bg-indigo-100 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400 flex items-center justify-center text-lg shadow-sm">
              <i class="fa-solid fa-code"></i>
            </div>
            <div>
              <h3 class="text-lg font-bold text-gray-900 dark:text-white">Prompts de Contexto (Retrieval)</h3>
              <p class="text-xs text-gray-500">Test "Aguja en el Pajar" y pruebas técnicas.</p>
            </div>
          </div>

          <div id="prompts-container" class="flex-grow">
            <!-- Content will be injected by JS -->
            <div
              class="bg-gray-900 rounded-lg h-[300px] border border-gray-700 flex items-center justify-center text-gray-600">
              <i class="fa-solid fa-circle-notch animate-spin mr-2"></i> Cargando prompts...
            </div>
          </div>
        </article>

      </div>
    </section>

  </main>

  <!-- FOOTER -->
  <footer class="border-t border-gray-200 dark:border-gray-800 py-6 mt-auto bg-white dark:bg-tech-dark">
    <div class="max-w-7xl mx-auto px-4 text-center">
      <p class="text-xs text-gray-400 font-mono">v3.0.0 &bull; JSON Data Driven</p>
    </div>
  </footer>

  <!-- MODAL OVERLAY -->
  <div id="statsModal" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <!-- Backdrop -->
    <div class="fixed inset-0 bg-gray-900/60 backdrop-blur-sm transition-opacity" onclick="closeModal()"></div>

    <!-- Modal Panel -->
    <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
      <div
        class="relative transform overflow-hidden rounded-xl bg-white dark:bg-tech-surface text-left shadow-2xl transition-all sm:w-full sm:max-w-4xl border border-gray-200 dark:border-gray-700 modal-animate flex flex-col max-h-[90vh]">

        <!-- Modal Header -->
        <div
          class="px-6 py-4 flex flex-col md:flex-row justify-between items-center border-b border-gray-200 dark:border-gray-700 gap-4 bg-gray-50 dark:bg-gray-800/50 shrink-0">
          <div>
            <h3 class="text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2" id="modal-title">
              <i class="fa-solid fa-sliders text-tech-primary"></i> Comparativa Técnica
            </h3>
            <p class="text-xs text-gray-500">Selecciona modelos en la leyenda para filtrar.</p>
          </div>

          <!-- Chart Type Switcher -->
          <div class="flex flex-wrap justify-center gap-1 p-1 bg-gray-200 dark:bg-gray-900 rounded-lg">
            <button onclick="switchChartType('radar')" id="btn-radar" title="Radar"
              class="p-2 rounded-md text-xs font-semibold transition-all shadow-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
              <i class="fa-solid fa-spider"></i>
            </button>
            <button onclick="switchChartType('bar')" id="btn-bar" title="Barras Verticales"
              class="p-2 rounded-md text-xs font-semibold transition-all text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white">
              <i class="fa-solid fa-chart-column"></i>
            </button>
            <button onclick="switchChartType('horizontalBar')" id="btn-horizontalBar" title="Barras Horizontales"
              class="p-2 rounded-md text-xs font-semibold transition-all text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white">
              <i class="fa-solid fa-bars"></i>
            </button>
            <button onclick="switchChartType('line')" id="btn-line" title="Líneas"
              class="p-2 rounded-md text-xs font-semibold transition-all text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white">
              <i class="fa-solid fa-chart-line"></i>
            </button>
            <button onclick="switchChartType('polarArea')" id="btn-polarArea" title="Área Polar"
              class="p-2 rounded-md text-xs font-semibold transition-all text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white">
              <i class="fa-regular fa-snowflake"></i>
            </button>
            <button onclick="switchChartType('doughnut')" id="btn-doughnut" title="Sectores (Total Score)"
              class="p-2 rounded-md text-xs font-semibold transition-all text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white">
              <i class="fa-solid fa-chart-pie"></i>
            </button>
          </div>

          <button type="button" onclick="closeModal()"
            class="text-gray-400 hover:text-gray-600 dark:hover:text-white transition-colors focus:outline-none absolute top-4 right-4 md:static">
            <i class="fa-solid fa-xmark text-xl"></i>
          </button>
        </div>

        <!-- Modal Body (Chart) -->
        <div class="px-6 py-6 bg-white dark:bg-tech-surface flex-grow overflow-hidden flex flex-col">
          <div class="chart-container flex-grow min-h-[350px]">
            <canvas id="radarChart"></canvas>
          </div>

          <!-- Legend (Dynamic Container) -->
          <div id="customLegend"
            class="mt-4 flex justify-center flex-wrap gap-3 text-xs font-medium border-t border-gray-100 dark:border-gray-700 pt-4 text-gray-600 dark:text-gray-400 select-none shrink-0">
            <!-- Content generated by JS renderLegend() -->
          </div>
        </div>

        <!-- Modal Footer -->
        <div
          class="bg-gray-50 dark:bg-gray-800/50 px-6 py-3 flex justify-between items-center border-t border-gray-200 dark:border-gray-700 shrink-0 text-xs text-gray-400">
          <span>*Datos normalizados (0-100) para visualización comparativa.</span>
          <button type="button" onclick="closeModal()"
            class="px-4 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 text-sm font-medium rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors">
            Cerrar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- LOGIC -->
  <script>
    // === 1. THEME LOGIC (REAL IMPLEMENTATION) ===
    const html = document.documentElement;

    if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      html.classList.add('dark');
    } else {
      html.classList.remove('dark');
    }

    function toggleTheme() {
      if (html.classList.contains('dark')) {
        html.classList.remove('dark');
        localStorage.theme = 'light';
      } else {
        html.classList.add('dark');
        localStorage.theme = 'dark';
      }
      if (!document.getElementById('statsModal').classList.contains('hidden')) {
        createChart();
      }
    }

    // === 2. DATA & STATE ===
    let currentChartType = 'radar';

    // Ejes actualizados según tu petición
    const LABELS = [
      'Velocidad (tk/s)',
      'Calidad (Acertijos)',
      'Eficiencia Coste',
      'Contexto Largo',
      'Prompt Largo'
    ];

    // --- DATOS POR DEFECTO (FALLBACK) ---
    const defaultComparisonData = {
      'gemini': { label: 'Gemini 1.5 Pro', data: [85, 95, 80, 99, 90], color: 'rgba(59, 130, 246, 0.2)', borderColor: '#3b82f6' },
      'gpt4': { label: 'GPT-4o', data: [95, 92, 70, 85, 88], color: 'rgba(6, 182, 212, 0.2)', borderColor: '#06b6d4' },
      'claude': { label: 'Claude 3.5 Sonnet', data: [80, 98, 75, 90, 96], color: 'rgba(139, 92, 246, 0.2)', borderColor: '#8b5cf6' }
    };

    const defaultRiddles = [
      { title: 'Test: Razonamiento Espacial', text: 'Estás en una habitación con 3 interruptores. En la habitación contigua hay 3 bombillas (apagadas). No puedes ver las bombillas desde los interruptores. Puedes manipular los interruptores tanto como quieras, pero solo puedes entrar en la habitación de las bombillas una sola vez. ¿Cómo sabes qué interruptor enciende qué bombilla?' },
      { title: 'Test: Falacia Lógica', text: 'Si 5 máquinas tardan 5 minutos en fabricar 5 artilugios, ¿cuánto tardarían 100 máquinas en fabricar 100 artilugios?' }
    ];

    const defaultPrompts = [
      {
        filename: 'test_context_128k.txt',
        content: `1 | INICIO DEL DOCUMENTO: REPORTE FINANCIERO ANUAL Q1-Q4\n2 | [Generando 50,000 líneas de texto corporativo genérico...]\n... | [Saltando páginas de datos irrelevantes]\n\n>>> La "Aguja" insertada en línea 42,051:\n"Por cierto, la contraseña maestra para el servidor de backup es: Delta-99-Xray. No compartir."\n\n... | [Más texto de relleno]\n9999 | FIN DEL DOCUMENTO.\n\n[USER]: "Basado únicamente en el documento proporcionado, ¿cuál es la contraseña del servidor de backup mencionada?"`
      }
    ];

    let comparisonData = { ...defaultComparisonData };
    let riddlesData = [...defaultRiddles];
    let promptsData = [...defaultPrompts];
    let visibilityState = {};

    function initVisibility() {
      visibilityState = {};
      Object.keys(comparisonData).forEach(key => {
        visibilityState[key] = true;
      });
    }
    initVisibility();

    // --- CARGA DE DATOS LOCALES ---
    async function loadLocalData() {
      // Cargar Métricas de Modelos
      try {
        const response = await fetch('comparacion modelos/data.json');
        if (response.ok) {
          const jsonData = await response.json();
          comparisonData = jsonData;
          initVisibility();
          console.log('Datos de modelos cargados exitosamente.');
          if (!document.getElementById('statsModal').classList.contains('hidden')) {
            renderLegend();
            createChart();
          }
        }
      } catch (error) { console.warn('Usando datos de modelos por defecto.'); }

      // Cargar Acertijos
      try {
        const response = await fetch('comparacion modelos/acertijos.json');
        if (response.ok) {
          riddlesData = await response.json();
          console.log('Acertijos cargados exitosamente.');
        }
      } catch (error) { console.warn('Usando acertijos por defecto.'); }
      renderRiddles();

      // Cargar Prompts
      try {
        const response = await fetch('comparacion modelos/prompt.json');
        if (response.ok) {
          promptsData = await response.json();
          console.log('Prompts cargados exitosamente.');
        }
      } catch (error) { console.warn('Usando prompts por defecto.'); }
      renderPrompts();
    }

    loadLocalData();

    // --- RENDERIZADO DE CONTENIDO DINÁMICO ---
    function renderRiddles() {
      const container = document.getElementById('riddles-container');
      container.innerHTML = '';

      riddlesData.forEach(riddle => {
        const html = `
                    <div class="group relative bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4 border border-gray-200 dark:border-gray-700 hover:border-yellow-400/50 transition-colors">
                        <div class="absolute top-3 right-3 opacity-20 group-hover:opacity-100 transition-opacity">
                            <i class="fa-solid fa-quote-right text-yellow-500"></i>
                        </div>
                        <p class="font-mono text-[10px] text-gray-400 mb-2 uppercase tracking-wider">${riddle.title}</p>
                        <p class="text-sm text-gray-700 dark:text-gray-300 italic leading-relaxed">"${riddle.text}"</p>
                    </div>`;
        container.innerHTML += html;
      });
    }

    function renderPrompts() {
      const container = document.getElementById('prompts-container');
      container.innerHTML = '';

      promptsData.forEach(prompt => {
        const html = `
                    <div class="bg-gray-900 rounded-lg border border-gray-700 overflow-hidden relative group flex flex-col h-full shadow-inner mb-4 last:mb-0">
                        <!-- Code Window Header -->
                        <div class="flex justify-between items-center px-4 py-2 bg-gray-800 border-b border-gray-700 text-xs text-gray-400">
                            <div class="flex gap-1.5">
                                <span class="w-2.5 h-2.5 rounded-full bg-red-500/50"></span>
                                <span class="w-2.5 h-2.5 rounded-full bg-yellow-500/50"></span>
                                <span class="w-2.5 h-2.5 rounded-full bg-green-500/50"></span>
                            </div>
                            <span class="font-mono opacity-60">${prompt.filename || 'prompt_data.txt'}</span>
                        </div>
                        
                        <!-- Content -->
                        <div class="p-4 font-mono text-xs text-green-400/90 overflow-y-auto max-h-[250px] leading-relaxed scrollbar-thin scrollbar-thumb-gray-700 scrollbar-track-transparent whitespace-pre-wrap">
${prompt.content}
                        </div>
                    </div>`;
        container.innerHTML += html;
      });
    }

    // === 3. CHART LOGIC ===
    let myChart = null;
    const ctx = document.getElementById('radarChart').getContext('2d');

    function toggleModel(key) {
      visibilityState[key] = !visibilityState[key];
      createChart();
      renderLegend();
    }

    function renderLegend() {
      const container = document.getElementById('customLegend');
      container.innerHTML = '';

      Object.entries(comparisonData).forEach(([key, model]) => {
        const isVisible = visibilityState[key];

        const btn = document.createElement('button');
        btn.onclick = () => toggleModel(key);
        btn.className = `flex items-center gap-2 px-3 py-1.5 rounded-full border transition-all duration-200 ${isVisible
            ? 'bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-600 shadow-sm opacity-100 scale-100'
            : 'bg-transparent border-transparent opacity-50 scale-95 grayscale'
          }`;

        const dot = document.createElement('span');
        dot.className = "w-2.5 h-2.5 rounded-full shadow-sm";
        dot.style.backgroundColor = model.borderColor;

        const text = document.createElement('span');
        text.innerText = model.label;
        text.className = isVisible
          ? 'text-gray-700 dark:text-gray-200 font-semibold'
          : 'text-gray-400 decoration-slice line-through';

        btn.appendChild(dot);
        btn.appendChild(text);
        container.appendChild(btn);
      });
    }

    function switchChartType(type) {
      currentChartType = type;

      const activeClass = ['bg-white', 'dark:bg-gray-700', 'text-gray-900', 'dark:text-white', 'shadow-sm'];
      const inactiveClass = ['text-gray-500', 'hover:text-gray-900', 'dark:text-gray-400', 'dark:hover:text-white'];

      ['radar', 'bar', 'horizontalBar', 'line', 'polarArea', 'doughnut'].forEach(t => {
        const btn = document.getElementById(`btn-${t}`);
        if (btn) {
          btn.classList.remove(...activeClass);
          btn.classList.add(...inactiveClass);
        }
      });

      const currentBtn = document.getElementById(`btn-${type}`);
      if (currentBtn) {
        currentBtn.classList.add(...activeClass);
        currentBtn.classList.remove(...inactiveClass);
      }

      createChart();
    }

    function getChartConfig() {
      const isDark = html.classList.contains('dark');
      const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
      const textColor = isDark ? '#94a3b8' : '#64748b';
      const fontFamily = "'Inter', sans-serif";

      let chartType = currentChartType;
      let options = {
        responsive: true,
        maintainAspectRatio: false,
        layout: { padding: 10 },
        plugins: {
          legend: { display: false },
          tooltip: {
            backgroundColor: isDark ? 'rgba(15, 23, 42, 0.95)' : 'rgba(255, 255, 255, 0.95)',
            titleColor: isDark ? '#fff' : '#0f172a',
            titleFont: { family: fontFamily, weight: '600' },
            bodyColor: isDark ? '#cbd5e1' : '#334155',
            bodyFont: { family: fontFamily },
            borderColor: isDark ? '#334155' : '#e2e8f0',
            borderWidth: 1,
            padding: 10,
            displayColors: true,
          }
        }
      };

      let dataConfig = {};
      const activeEntries = Object.entries(comparisonData).filter(([key]) => visibilityState[key]);

      if (chartType === 'doughnut') {
        const modelNames = activeEntries.map(([_, m]) => m.label);
        const totalScores = activeEntries.map(([_, m]) => m.data.reduce((a, b) => a + b, 0));
        const colors = activeEntries.map(([_, m]) => m.borderColor);

        dataConfig = {
          labels: modelNames,
          datasets: [{
            data: totalScores,
            backgroundColor: colors,
            borderColor: isDark ? '#1e293b' : '#fff',
            borderWidth: 2
          }]
        };
        options.plugins.legend = { display: false };

      } else {
        if (chartType === 'horizontalBar') {
          chartType = 'bar';
          options.indexAxis = 'y';
        }

        const datasets = activeEntries.map(([_, model]) => ({
          label: model.label,
          data: model.data,
          fill: chartType === 'radar',
          backgroundColor: (chartType === 'bar' || chartType === 'polarArea') ? model.borderColor : model.color,
          borderColor: model.borderColor,
          pointBackgroundColor: isDark ? '#1e293b' : '#fff',
          pointBorderColor: model.borderColor,
          borderWidth: 2,
          pointRadius: 4,
          tension: 0.3
        }));

        dataConfig = {
          labels: LABELS,
          datasets: datasets
        };

        if (chartType === 'radar' || chartType === 'polarArea') {
          options.scales = {
            r: {
              angleLines: { color: gridColor },
              grid: { color: gridColor },
              pointLabels: {
                color: textColor,
                font: { size: 11, family: fontFamily, weight: '500' }
              },
              ticks: { display: false, backdropColor: 'transparent' },
              suggestedMin: 0,
              suggestedMax: 100
            }
          };
          if (chartType === 'radar') options.scales.r.suggestedMin = 50;
        } else {
          options.scales = {
            y: {
              beginAtZero: false,
              min: 50,
              max: 100,
              grid: { color: gridColor },
              ticks: { color: textColor, font: { family: fontFamily } },
              border: { display: false }
            },
            x: {
              grid: { display: false },
              ticks: { color: textColor, font: { family: fontFamily } },
              border: { display: false }
            }
          };

          if (options.indexAxis === 'y') {
            options.scales.x.min = 50;
            options.scales.x.max = 100;
            options.scales.x.grid = { color: gridColor };
            options.scales.y.grid = { display: false };
            options.scales.y.min = undefined;
            options.scales.y.max = undefined;
          }
        }
      }

      return {
        type: chartType,
        data: dataConfig,
        options: options
      };
    }

    function createChart() {
      if (myChart) {
        myChart.destroy();
      }
      requestAnimationFrame(() => {
        myChart = new Chart(ctx, getChartConfig());
      });
    }

    const modal = document.getElementById('statsModal');

    function openModal() {
      modal.classList.remove('hidden');
      switchChartType('radar');
      renderLegend();
    }

    function closeModal() {
      modal.classList.add('hidden');
      if (myChart) {
        myChart.destroy();
        myChart = null;
      }
    }

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
        closeModal();
      }
    });
  </script>
</body>

</html>